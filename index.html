<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>F1 MONZA 賽車旅遊 Pro</title>
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8f9fa; -webkit-tap-highlight-color: transparent; }
        .ferrari-red { background-color: #FF0000; }
        .text-ferrari { color: #FF0000; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .v-enter-active, .v-leave-active { transition: all 0.3s ease; }
        .v-enter-from, .v-leave-to { opacity: 0; transform: translateY(-10px); }
        .countdown-box { background: rgba(0, 0, 0, 0.2); backdrop-filter: blur(5px); }
    </style>
</head>
<body>
    <div id="app" class="max-w-md mx-auto min-h-screen bg-gray-50 flex flex-col shadow-xl overflow-hidden relative">
        
        <!-- Header 區塊 -->
        <header class="ferrari-red text-white p-6 pb-12 rounded-b-[40px] shadow-lg relative z-30">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h1 class="text-2xl font-black italic tracking-tighter uppercase">Monza 2026</h1>
                    <p class="text-[10px] opacity-70 font-bold tracking-widest uppercase">The Temple of Speed</p>
                </div>
                <!-- 工具列 -->
                <div class="flex items-center gap-2">
                    <button @click="activeTab = 'docs'" class="w-9 h-9 rounded-full bg-white/20 flex items-center justify-center border border-white/30"><i class="fas fa-flag-checkered"></i></button>
                    <button @click="toggleCurrency" class="h-9 px-3 rounded-full bg-white/20 flex items-center gap-1 border border-white/30"><span class="text-[10px] font-bold">€1={{ exchangeRate }}</span></button>
                    <button @click="toggleTranslate" class="w-9 h-9 rounded-full bg-white/20 flex items-center justify-center border border-white/30"><i class="fas fa-language"></i></button>
                </div>
            </div>

            <!-- 倒數計時器 (修復版) -->
            <div class="countdown-box rounded-2xl p-3 flex justify-around text-center border border-white/10">
                <div v-for="(val, unit) in countdown" :key="unit">
                    <span class="block text-xl font-black leading-none">{{ val }}</span>
                    <span class="text-[8px] uppercase font-bold opacity-60">{{ unitMap[unit] }}</span>
                </div>
            </div>

            <!-- 工具彈窗：匯率 -->
            <transition>
                <div v-if="showCurrency" class="absolute left-6 right-6 top-full mt-2 bg-white rounded-3xl p-5 shadow-2xl text-gray-800 border border-gray-100">
                    <div class="flex justify-between text-xs font-black text-ferrari mb-3 uppercase italic">匯率換算 (EUR/TWD)</div>
                    <div class="flex items-center gap-3 bg-gray-100 p-4 rounded-2xl">
                        <input v-model="eurInput" type="number" class="w-full bg-transparent border-none p-0 font-black text-xl focus:ring-0">
                        <i class="fas fa-exchange-alt text-gray-300"></i>
                        <div class="w-full text-right font-black text-xl text-ferrari">≈ {{ (eurInput * exchangeRate).toFixed(0) }} <span class="text-[10px]">NT</span></div>
                    </div>
                </div>
            </transition>

            <!-- 工具彈窗：翻譯 -->
            <transition>
                <div v-if="showTranslate" class="absolute left-6 right-6 top-full mt-2 bg-white rounded-3xl p-5 shadow-2xl text-gray-800 border border-gray-100">
                    <div class="flex justify-between text-xs font-black text-ferrari mb-3 uppercase italic">內建翻譯 (中 → 意)</div>
                    <div class="flex gap-2">
                        <input v-model="transInput" @keyup.enter="translateText" type="text" placeholder="輸入中文..." class="w-full bg-gray-100 border-none rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-red-500">
                        <button @click="translateText" class="ferrari-red text-white px-4 rounded-xl"><i v-if="!isTranslating" class="fas fa-search"></i><i v-else class="fas fa-spinner animate-spin"></i></button>
                    </div>
                    <div v-if="transResult" class="mt-3 p-3 bg-red-50 rounded-xl border border-red-100 text-gray-800 font-bold">{{ transResult }}</div>
                </div>
            </transition>
        </header>

        <!-- 主內容區 -->
        <main class="flex-1 overflow-y-auto px-4 -mt-8 no-scrollbar pb-32 z-10">
            <!-- 行程標籤頁 -->
            <div v-if="activeTab === 'itinerary'">
                <div class="flex gap-3 overflow-x-auto no-scrollbar py-4 mb-2">
                    <div v-for="date in allDates" :key="date" @click="selectedDate = date"
                        :class="[ 'flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center transition-all', selectedDate === date ? 'ferrari-red text-white scale-110 shadow-lg' : 'bg-white text-gray-500 shadow-sm' ]">
                        <span class="text-[10px] uppercase font-bold">{{ formatDate(date, 'MMM') }}</span>
                        <span class="text-xl font-black">{{ formatDate(date, 'DD') }}</span>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="flex justify-between items-center px-1">
                        <h2 class="font-black text-gray-800 italic uppercase">Daily Schedule</h2>
                        <button @click="showAddModal = true" class="text-[10px] font-black bg-white text-ferrari px-3 py-1.5 rounded-full shadow-sm">+ ADD</button>
                    </div>
                    <div v-for="item in currentDayItems" :key="item.id" class="bg-white p-5 rounded-3xl shadow-sm flex gap-4 items-center border border-gray-100">
                        <div class="text-center min-w-[50px] font-black text-lg text-gray-800">{{ item.time }}</div>
                        <div class="flex-1 border-l border-gray-100 pl-4">
                            <h3 class="font-bold text-gray-800">{{ item.activity }}</h3>
                            <p class="text-[10px] text-gray-400 font-medium"><i class="fas fa-map-marker-alt text-ferrari mr-1"></i>{{ item.location }}</p>
                        </div>
                        <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(item.location)" target="_blank" class="w-10 h-10 rounded-2xl bg-gray-50 text-blue-500 flex items-center justify-center"><i class="fas fa-location-arrow"></i></a>
                    </div>
                </div>
            </div>

            <!-- 文件標籤頁 -->
            <div v-if="activeTab === 'docs'" class="pt-8">
                <h2 class="font-black text-xl italic mb-6 uppercase tracking-tight"><i class="fas fa-flag-checkered text-ferrari mr-2"></i>My Tickets</h2>
                <div class="grid grid-cols-2 gap-4">
                    <div v-for="(file, idx) in files" :key="idx" class="relative group">
                        <div class="bg-white p-2 rounded-2xl shadow-md border border-gray-100 aspect-[3/4] overflow-hidden">
                            <img v-if="file.type.includes('image')" :src="file.url" class="w-full h-full object-cover rounded-xl">
                            <div v-else class="w-full h-full flex flex-col items-center justify-center bg-gray-50 rounded-xl">
                                <i class="fas fa-file-pdf text-3xl text-red-500 mb-1"></i>
                                <p class="text-[8px] text-gray-400 text-center px-2 font-bold uppercase break-all">{{ file.name }}</p>
                            </div>
                        </div>
                        <button @click="removeFile(idx)" class="absolute -top-2 -right-2 bg-black text-white w-6 h-6 rounded-full text-[10px]"><i class="fas fa-times"></i></button>
                    </div>
                    <button @click="triggerFileUpload" class="border-2 border-dashed border-gray-200 rounded-2xl flex flex-col items-center justify-center aspect-[3/4] text-gray-300 hover:text-ferrari bg-white/50">
                        <i class="fas fa-plus text-2xl mb-1"></i>
                        <span class="text-[10px] font-black uppercase">Upload</span>
                    </button>
                    <input type="file" id="fileInput" class="hidden" @change="handleFileUpload" accept="image/*,application/pdf">
                </div>
            </div>

            <!-- 分帳標籤頁 -->
            <div v-if="activeTab === 'wallet'" class="pt-8">
                <div class="bg-gray-900 rounded-[35px] p-8 text-white shadow-2xl relative overflow-hidden">
                    <p class="text-gray-400 text-[10px] font-bold uppercase tracking-widest mb-1">Total Pilgrimage Expense</p>
                    <h2 class="text-3xl font-black italic italic">€ {{ totalExpenses }}</h2>
                    <div class="mt-6 pt-6 border-t border-white/10 flex justify-between items-center text-xs font-bold text-ferrari uppercase">Coming Soon</div>
                </div>
            </div>
        </main>

        <!-- 底部導航 -->
        <nav class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/90 backdrop-blur-md border-t border-gray-100 px-10 py-5 flex justify-between items-center safe-area-bottom z-50">
            <button @click="activeTab = 'itinerary'" :class="activeTab === 'itinerary' ? 'text-ferrari scale-110' : 'text-gray-300'"><i class="fas fa-calendar-alt text-xl"></i></button>
            <button @click="activeTab = 'docs'" :class="activeTab === 'docs' ? 'text-ferrari scale-110' : 'text-gray-300'"><i class="fas fa-flag-checkered text-xl"></i></button>
            <button @click="activeTab = 'wallet'" :class="activeTab === 'wallet' ? 'text-ferrari scale-110' : 'text-gray-300'"><i class="fas fa-wallet text-xl"></i></button>
            <button @click="activeTab = 'settings'" :class="activeTab === 'settings' ? 'text-ferrari scale-110' : 'text-gray-300'"><i class="fas fa-cog text-xl"></i></button>
        </nav>

        <!-- 行程新增 Modal -->
        <div v-if="showAddModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end justify-center z-[100] p-4">
            <div class="bg-white w-full rounded-[40px] p-8 animate-slide-up">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-black italic uppercase">Add Event</h3>
                    <i @click="showAddModal = false" class="fas fa-times text-gray-300 cursor-pointer"></i>
                </div>
                <div class="space-y-4">
                    <input v-model="newItem.time" type="time" class="w-full bg-gray-100 border-none rounded-2xl px-5 py-4 font-black">
                    <input v-model="newItem.activity" type="text" placeholder="Activity Name" class="w-full bg-gray-100 border-none rounded-2xl px-5 py-4">
                    <input v-model="newItem.location" type="text" placeholder="Location" class="w-full bg-gray-100 border-none rounded-2xl px-5 py-4">
                    <button @click="addItem" class="w-full ferrari-red text-white py-5 rounded-2xl font-black uppercase italic shadow-lg shadow-red-100 mt-4">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                const activeTab = ref('itinerary');
                const selectedDate = ref('2026-09-02');
                const startDate = ref('2026-09-02');
                const endDate = ref('2026-09-07');
                
                // 1. 倒數計時器邏輯 (核心修復)
                const countdown = ref({ d: 0, h: 0, m: 0, s: 0 });
                const unitMap = { d: 'Days', h: 'Hrs', m: 'Min', s: 'Sec' };
                
                const updateTimer = () => {
                    const target = new Date("2026-09-06T15:00:00").getTime();
                    const now = new Date().getTime();
                    const diff = target - now;
                    
                    if (diff > 0) {
                        countdown.value.d = Math.floor(diff / (1000 * 60 * 60 * 24));
                        countdown.value.h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        countdown.value.m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        countdown.value.s = Math.floor((diff % (1000 * 60)) / 1000);
                    }
                };

                // 2. 匯率獲取 (使用 HTTPS API)
                const exchangeRate = ref(35.5);
                const showCurrency = ref(false);
                const eurInput = ref(1);
                const toggleCurrency = () => { showCurrency.value = !showCurrency.value; showTranslate.value = false; };
                
                const fetchRate = async () => {
                    try {
                        const res = await fetch('https://open.er-api.com/v6/latest/EUR');
                        const data = await res.json();
                        exchangeRate.value = data.rates.TWD.toFixed(1);
                    } catch (e) { console.error("Rate API Error"); }
                };

                // 3. 翻譯邏輯 (內建)
                const showTranslate = ref(false);
                const transInput = ref('');
                const transResult = ref('');
                const isTranslating = ref(false);
                const toggleTranslate = () => { showTranslate.value = !showTranslate.value; showCurrency.value = false; };
                
                const translateText = async () => {
                    if (!transInput.value) return;
                    isTranslating.value = true;
                    try {
                        const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(transInput.value)}&langpair=zh-TW|it`);
                        const data = await res.json();
                        transResult.value = data.responseData.translatedText;
                    } catch (e) { transResult.value = "翻譯失敗"; }
                    finally { isTranslating.value = false; }
                };

                // 4. 資料存儲與行程
                const itinerary = ref(JSON.parse(localStorage.getItem('monza_itinerary')) || [
                    { id: 1, date: '2026-09-06', time: '15:00', activity: 'Main Race Day', location: 'Autodromo di Monza' }
                ]);
                const files = ref(JSON.parse(localStorage.getItem('monza_files')) || []);
                const showAddModal = ref(false);
                const newItem = ref({ time: '', activity: '', location: '' });

                const allDates = computed(() => {
                    const dates = [];
                    let curr = new Date(startDate.value);
                    while (curr <= new Date(endDate.value)) {
                        dates.push(curr.toISOString().split('T')[0]);
                        curr.setDate(curr.getDate() + 1);
                    }
                    return dates;
                });

                const currentDayItems = computed(() => {
                    return itinerary.value.filter(i => i.date === selectedDate.value)
                        .sort((a, b) => a.time.localeCompare(b.time));
                });

                const addItem = () => {
                    if (newItem.value.time && newItem.value.activity) {
                        itinerary.value.push({ id: Date.now(), date: selectedDate.value, ...newItem.value });
                        newItem.value = { time: '', activity: '', location: '' };
                        showAddModal.value = false;
                        saveData();
                    }
                };

                const triggerFileUpload = () => document.getElementById('fileInput').click();
                const handleFileUpload = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        files.value.push({ name: file.name, type: file.type, url: event.target.result });
                        saveData();
                    };
                    reader.readAsDataURL(file);
                };
                const removeFile = (idx) => { files.value.splice(idx, 1); saveData(); };

                const formatDate = (d, type) => {
                    const date = new Date(d);
                    return type === 'MMM' ? date.toLocaleString('en-US', { month: 'short' }) : date.getDate();
                };

                const saveData = () => {
                    localStorage.setItem('monza_itinerary', JSON.stringify(itinerary.value));
                    localStorage.setItem('monza_files', JSON.stringify(files.value));
                };

                onMounted(() => {
                    fetchRate();
                    updateTimer();
                    setInterval(updateTimer, 1000); // 啟動計時器
                });

                return {
                    activeTab, selectedDate, allDates, currentDayItems, formatDate, startDate, endDate,
                    countdown, unitMap, exchangeRate, eurInput, showCurrency, toggleCurrency,
                    showTranslate, toggleTranslate, transInput, transResult, translateText, isTranslating,
                    files, triggerFileUpload, handleFileUpload, removeFile,
                    showAddModal, newItem, addItem, totalExpenses: 0
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
